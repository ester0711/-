<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é‡‘åº“ç´¯ç§¯ - é©¬å¸ç‰ˆ</title>
    <style>
        :root {
            --primary: #006442; /* é©¬æ¥è¥¿äºšæŠ¤ç…§/é‡‘èå¸¸ç”¨æ·±ç»¿è‰² */
            --accent: #FFD700;  /* é‡‘è‰² */
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 480px;
            position: relative;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        /* è®¾ç½®é¢æ¿æ ·å¼ */
        .settings-panel {
            background: #fff;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
            color: #555;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .btn-save {
            width: 100%;
            padding: 14px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-save:hover {
            background-color: #004d33;
        }

        /* æ˜¾ç¤ºé¢æ¿æ ·å¼ */
        .display-panel {
            text-align: center;
        }

        .money-card {
            background: linear-gradient(135deg, #006442 0%, #004d33 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,100,66,0.3);
        }

        .money-title {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .money-value {
            font-size: 3rem;
            font-weight: 700;
            font-family: 'Courier New', monospace; /* ç­‰å®½å­—ä½“é˜²æ­¢è·³åŠ¨ */
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .currency-symbol {
            font-size: 1.5rem;
            vertical-align: super;
            margin-right: 5px;
        }

        .per-second {
            font-size: 0.8rem;
            margin-top: 10px;
            opacity: 0.8;
            background: rgba(255,255,255,0.1);
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .section-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            text-align: left;
        }

        .section-title {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .countdown-time {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--text);
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--accent);
            width: 0%;
            transition: width 1s linear;
        }

        .hidden {
            display: none;
        }

        .edit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: #999;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="settingsPanel" class="settings-panel">
        <h1>ğŸ› ï¸ æ‘¸é±¼å‚æ•°è®¾ç½®</h1>
        
        <div class="form-group">
            <label>æœˆè–ª (RM)</label>
            <input type="number" id="salary" placeholder="ä¾‹å¦‚: 5000" value="5000">
        </div>

        <div class="form-group">
            <label>æ¯æœˆå·¥ä½œå¤©æ•° (é»˜è®¤22å¤©)</label>
            <input type="number" id="workDays" value="22">
        </div>

        <div class="form-group">
            <label>ä¸Šç­æ—¶é—´</label>
            <input type="time" id="startTime" value="09:00">
        </div>

        <div class="form-group">
            <label>ä¸‹ç­æ—¶é—´</label>
            <input type="time" id="endTime" value="18:00">
        </div>

        <div class="form-group">
            <label>é€€ä¼‘ç›®æ ‡æ—¥æœŸ</label>
            <input type="date" id="retireDate">
        </div>

        <button class="btn-save" onclick="saveAndStart()">ğŸš€ å¼€å§‹ç´¯è®¡å°é‡‘åº“</button>
    </div>

    <div id="displayPanel" class="display-panel hidden">
        <button class="edit-btn" onclick="toggleSettings()">âš™ï¸ ä¿®æ”¹è®¾ç½®</button>
        <h1>ğŸ’° å°é‡‘åº“ç´¯è®¡</h1>

        <div class="money-card">
            <div class="money-title">ä»Šæ—¥å·²èµšå–</div>
            <div class="money-value"><span class="currency-symbol">RM</span><span id="earnedMoney">0.00</span></div>
            <div class="per-second">ç§’è–ª: RM <span id="salaryPerSecond">0.0000</span></div>
        </div>

        <div class="section-card">
            <div class="section-title">
                <span>â³ è·ç¦»ä¸‹ç­</span>
                <span id="progressText">0%</span>
            </div>
            <div class="countdown-time" id="workCountdown">--:--:--</div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div class="section-card">
            <div class="section-title">ğŸŒ´ è·ç¦»é€€ä¼‘</div>
            <div class="countdown-time" id="retireCountdown" style="color: #666; font-size: 1.1rem;">
                æœªè®¾ç½®æ—¥æœŸ
            </div>
        </div>
    </div>
</div>

<script>
    let timer;

    // é¡µé¢åŠ è½½æ—¶è¯»å–ç¼“å­˜
    window.onload = function() {
        const savedSalary = localStorage.getItem('my_salary');
        if (savedSalary) {
            document.getElementById('salary').value = savedSalary;
            document.getElementById('workDays').value = localStorage.getItem('my_workDays') || 22;
            document.getElementById('startTime').value = localStorage.getItem('my_startTime') || "09:00";
            document.getElementById('endTime').value = localStorage.getItem('my_endTime') || "18:00";
            document.getElementById('retireDate').value = localStorage.getItem('my_retireDate') || "";
            
            // ç›´æ¥è¿›å…¥æ˜¾ç¤ºæ¨¡å¼
            toggleSettings(false);
            startTimer();
        }
    };

    function toggleSettings(showSettings = true) {
        if (showSettings) {
            document.getElementById('settingsPanel').classList.remove('hidden');
            document.getElementById('displayPanel').classList.add('hidden');
            clearInterval(timer);
        } else {
            document.getElementById('settingsPanel').classList.add('hidden');
            document.getElementById('displayPanel').classList.remove('hidden');
        }
    }

    function saveAndStart() {
        const salary = document.getElementById('salary').value;
        const workDays = document.getElementById('workDays').value;
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        const retireDate = document.getElementById('retireDate').value;

        if (!salary || !startTime || !endTime) {
            alert('è¯·å¡«å†™å®Œæ•´çš„è–ªèµ„å’Œæ—¶é—´ä¿¡æ¯ï¼');
            return;
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('my_salary', salary);
        localStorage.setItem('my_workDays', workDays);
        localStorage.setItem('my_startTime', startTime);
        localStorage.setItem('my_endTime', endTime);
        localStorage.setItem('my_retireDate', retireDate);

        toggleSettings(false);
        startTimer();
    }

    function startTimer() {
        if (timer) clearInterval(timer);
        updateDisplay(); // ç«‹å³è¿è¡Œä¸€æ¬¡
        timer = setInterval(updateDisplay, 100); // æ¯100æ¯«ç§’åˆ·æ–°
    }

    function updateDisplay() {
        const now = new Date();
        
        // --- 1. è·å–ç”¨æˆ·è®¾ç½® ---
        const salary = parseFloat(document.getElementById('salary').value);
        const workDays = parseFloat(document.getElementById('workDays').value);
        const startTimeStr = document.getElementById('startTime').value;
        const endTimeStr = document.getElementById('endTime').value;
        
        // --- 2. æ„é€ ä»Šå¤©çš„æ—¶é—´å¯¹è±¡ ---
        const [startH, startM] = startTimeStr.split(':');
        const [endH, endM] = endTimeStr.split(':');
        
        const startDate = new Date();
        startDate.setHours(startH, startM, 0, 0);
        
        const endDate = new Date();
        endDate.setHours(endH, endM, 0, 0);

        // è®¡ç®—å…¨å¤©å·¥ä½œæ€»ç§’æ•°
        const totalWorkMs = endDate - startDate;
        
        // è®¡ç®—ç§’è–ª (æœˆè–ª / å·¥ä½œå¤©æ•° / æ¯å¤©å·¥ä½œæ¯«ç§’æ•°)
        // é˜²æ­¢é™¤ä»¥0
        if (totalWorkMs <= 0) return;
        const salaryPerMs = (salary / workDays) / totalWorkMs;
        
        // --- 3. è®¡ç®—å·²èµšå–çš„é’± ---
        let currentWorkMs = now - startDate;
        
        // è¾¹ç•Œå¤„ç†ï¼šè¿˜æ²¡ä¸Šç­
        if (currentWorkMs < 0) currentWorkMs = 0;
        // è¾¹ç•Œå¤„ç†ï¼šå·²ç»ä¸‹ç­
        if (currentWorkMs > totalWorkMs) currentWorkMs = totalWorkMs;

        const earned = currentWorkMs * salaryPerMs;
        const perSecond = salaryPerMs * 1000;

        // æ›´æ–°DOM
        document.getElementById('earnedMoney').innerText = earned.toFixed(4); // ä¿ç•™4ä½å°æ•°å¢åŠ è·³åŠ¨æ„Ÿ
        document.getElementById('salaryPerSecond').innerText = perSecond.toFixed(4);

        // --- 4. ä¸‹ç­å€’è®¡æ—¶ & è¿›åº¦æ¡ ---
        let remainingMs = endDate - now;
        let percentage = (currentWorkMs / totalWorkMs) * 100;
        
        if (remainingMs <= 0) {
            document.getElementById('workCountdown').innerText = "ğŸ‰ å·²ä¸‹ç­ï¼";
            document.getElementById('workCountdown').style.color = "#006442";
            percentage = 100;
        } else if (now < startDate) {
            document.getElementById('workCountdown').innerText = "ğŸ’¤ å°šæœªå¼€å·¥";
            percentage = 0;
        } else {
            // æ ¼å¼åŒ–å€’è®¡æ—¶
            const h = Math.floor(remainingMs / 3600000);
            const m = Math.floor((remainingMs % 3600000) / 60000);
            const s = Math.floor((remainingMs % 60000) / 1000);
            document.getElementById('workCountdown').innerText = 
                `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            document.getElementById('workCountdown').style.color = "#333";
        }

        document.getElementById('progressBar').style.width = percentage + "%";
        document.getElementById('progressText').innerText = percentage.toFixed(1) + "%";

        // --- 5. é€€ä¼‘å€’è®¡æ—¶ ---
        const retireDateStr = document.getElementById('retireDate').value;
        if (retireDateStr) {
            const retireDate = new Date(retireDateStr);
            const diffMs = retireDate - now;

            if (diffMs > 0) {
                const rYears = Math.floor(diffMs / (1000 * 60 * 60 * 24 * 365));
                const rDays = Math.floor((diffMs % (1000 * 60 * 60 * 24 * 365)) / (1000 * 60 * 60 * 24));
                const rHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                let text = "";
                if(rYears > 0) text += `${rYears}å¹´ `;
                text += `${rDays}å¤© ${rHours}å°æ—¶`;
                
                document.getElementById('retireCountdown').innerText = text;
            } else {
                document.getElementById('retireCountdown').innerText = "ğŸ‘´ æ‚¨å·²åˆ°è¾¾é€€ä¼‘æ—¥æœŸï¼";
            }
        } else {
            document.getElementById('retireCountdown').innerText = "æœªè®¾ç½®æ—¥æœŸï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’è®¾ç½®";
        }
    }
</script>

</body>
</html>